<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create a Map • DatawRappr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Create a Map">
<meta property="og:description" content="How to create a simple choropleth map with DatawRappt
">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DatawRappr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/map.html">Create a Map</a>
    </li>
    <li>
      <a href="../articles/usage.html">Using the API</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/munichrocker/DatawRappr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Create a Map</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/munichrocker/DatawRappr/blob/master/vignettes/map.Rmd"><code>vignettes/map.Rmd</code></a></small>
      <div class="hidden name"><code>map.Rmd</code></div>

    </div>

    
    
<p>There will probably be a function to create a map in one run in the next major version of {DatawRappr}. In the meantime, I wrote this tutorial:</p>
<p>There are three map types in Datawrapper: locator, symbol and choropleth. I’m trying to explain in short, how you can use DatawRappr to create a map programmatically for <strong>symbols</strong> and <strong>choropleths</strong>. And as an add-on: How to <strong>create a tooltip</strong> using {DatawRappr}.</p>
<p>Why exclude Locator-maps? They are a little tricky and probably not so heavily automated compared to choropleths and symbols. That’s why I decided place them a little lower on my priority list and keep them out here. There is a <a href="https://developer.datawrapper.de/docs/creating-a-locator-map">tutorial on Locator-maps with the API by Datawrapper</a> using <code>curl</code>.</p>
<p>The basic steps are always the same:</p>
<ul>
<li>Create a new chart with chart-type <code>map</code>.</li>
<li>Upload your data to this chart/map with the required columns (IDs or Lat/Long-coordinates).</li>
<li>Edit the chart to select the matching for the columns.</li>
<li>Publish the chart.</li>
</ul>
<p>If you want to update the data, you will only need steps 2 and 4.</p>
<hr>
<div id="create-a-choropleth-map" class="section level1">
<h1 class="hasAnchor">
<a href="#create-a-choropleth-map" class="anchor"></a>Create a Choropleth map</h1>
<div id="create-a-new-chart" class="section level2">
<h2 class="hasAnchor">
<a href="#create-a-new-chart" class="anchor"></a>Create a new chart</h2>
<p>You can use this code to create a new chart and save the chart to your current environment. You don’t have to save it. You will just need the chart-id later.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">new_choropleth_chart</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dw_create_chart.html">dw_create_chart</a></span>(
  <span class="kw">title</span> <span class="kw">=</span> <span class="st">"This is a automated choropleth map"</span>,
  <span class="kw">type</span> <span class="kw">=</span> <span class="st">"d3-maps-choropleth"</span>
  )
<span class="co">#&gt; New chart's id: LFukR</span></pre></body></html></div>
</div>
<div id="upload-data-to-the-chart" class="section level2">
<h2 class="hasAnchor">
<a href="#upload-data-to-the-chart" class="anchor"></a>Upload data to the chart</h2>
<p>We will now upload some data to our newly created map. Beforehand, we have to decide on an basemap and a key that maps the data to the chart.</p>
<div id="select-the-right-map" class="section level3">
<h3 class="hasAnchor">
<a href="#select-the-right-map" class="anchor"></a>Select the right map</h3>
<p>Datawrapper provides an API-endpoint with their basemaps, which you might <code>curl</code></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">curl</span> --request GET \</a>
<a class="sourceLine" id="cb2-2" title="2">  --url https://api.datawrapper.de/plugin/basemaps</a></code></pre></div>
<p>Or you can use the built-in dataframe in DatawRappr:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">dw_basemaps</span>)
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   id         level  slug   value      label      description                    </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;                          </span>
<span class="co">#&gt; 1 world-2019 World  world  DW_NAME    Name       The three-letter ISO-code of t…</span>
<span class="co">#&gt; 2 world-2019 World  world  DW_STATE_… ISO-Code   The written name of the countr…</span>
<span class="co">#&gt; 3 world-2019 World  world  GERMAN_NA… Name (Ger… The written name of the countr…</span>
<span class="co">#&gt; 4 africa-20… Africa africa DW_NAME    Name       The three-letter ISO-code of t…</span>
<span class="co">#&gt; 5 africa-20… Africa africa DW_STATE_… ISO-Code   The written name of the countr…</span>
<span class="co">#&gt; 6 europe     Europe europe ISO_A3     ISO 3-dig… DE21, FR24, TR42, ...</span></pre></body></html></div>
<p>First, you have to decide, which map to use. It is identified by the <code>id</code>-column.</p>
<p>You can use dplyr’s <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> to get an interactive table. Or you might want to filter using <code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code></p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">dw_basemaps</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"us-nyc"</span>, <span class="no">id</span>))
<span class="co">#&gt; # A tibble: 10 x 6</span>
<span class="co">#&gt;    id          level             slug            value  label     description   </span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;             &lt;chr&gt;           &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;         </span>
<span class="co">#&gt;  1 us-nyc-bor… USA » New York C… usa-new-york-c… BoroN… Borough … "Name of the …</span>
<span class="co">#&gt;  2 us-nyc-cen… USA » New York C… usa-new-york-c… BoroC… BoroCT20… ""            </span>
<span class="co">#&gt;  3 us-nyc-cen… USA » New York C… usa-new-york-c… geoid  GEOID co… ""            </span>
<span class="co">#&gt;  4 us-nyc-cit… USA » New York C… usa-new-york-c… CounD… Council … ""            </span>
<span class="co">#&gt;  5 us-nyc-com… USA » New York C… usa-new-york-c… BoroCD Boro CD … ""            </span>
<span class="co">#&gt;  6 us-nyc-hoo… USA » New York C… usa-new-york-c… NTANa… NTA Name  ""            </span>
<span class="co">#&gt;  7 us-nyc-hoo… USA » New York C… usa-new-york-c… NTACo… NTA Code  ""            </span>
<span class="co">#&gt;  8 us-nyc-pol… USA » New York C… usa-new-york-c… Preci… Precinct… ""            </span>
<span class="co">#&gt;  9 us-nyc-sch… USA » New York C… usa-new-york-c… Schoo… School D… ""            </span>
<span class="co">#&gt; 10 us-nyc-zip… USA » New York C… usa-new-york-c… ZIPCO… ZIP code  ""</span></pre></body></html></div>
</div>
<div id="select-the-right-key" class="section level3">
<h3 class="hasAnchor">
<a href="#select-the-right-key" class="anchor"></a>Select the right key</h3>
<p>In a second step, you have to choose a key for the map, which is identified in <code>value</code>. <code>label</code> and <code>description</code> provide some more details about it.</p>
<p>The key is the variable that binds the data to the map.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">dw_basemaps</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"germany-nuts3"</span>, <span class="no">id</span>))
<span class="co">#&gt; # A tibble: 2 x 6</span>
<span class="co">#&gt;   id          level         slug        value    label description              </span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;                    </span>
<span class="co">#&gt; 1 germany-nu… Germany » NU… germany-nu… NUTS_NA… Name  The written name of the …</span>
<span class="co">#&gt; 2 germany-nu… Germany » NU… germany-nu… NUTS_ID  Code  code / desc</span></pre></body></html></div>
<p>In this example the basemap <code>germany-nuts3</code> offers two key-options: <code>NUTS_ID</code> and <code>NUTS_NAME</code>. If you already have one of these options in your dataset, select the right one.</p>
<p>Otherwise, you will have to wrangle the data anyway.</p>
<hr>
<p><strong>Getting Country IDs</strong></p>
<p>You can easily transform country names in various formats and languages with the <a href="https://github.com/vincentarelbundock/countrycode">{countrycode}</a>-package. In most cases you won’t need a manual translation table. The package is available via CRAN or Github.</p>
<p>After installation, simply add a column with something like <code>countrycode::countrycode(sourcevar = SOURCE VARIABLE, origin = "country.name.de", destination = "iso3c")</code> to your dataframe.</p>
<hr>
<p>Just in case you need it: You can retrieve the expected keys for a basemap by calling this API-endpoint. Simply enter the <code>id</code> of the basemap and the <code>value</code> of the key:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="ex">curl</span> --request GET \</a>
<a class="sourceLine" id="cb6-2" title="2">  --url https://api.datawrapper.de/plugin/basemaps/ID/VALUE</a></code></pre></div>
<p>you could also use the {jsonlite}-package for this task:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">jsonlite</span>)

<span class="no">r</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://jeroen.cran.dev/jsonlite/reference/fromJSON.html">fromJSON</a></span>(<span class="st">"https://api.datawrapper.de/plugin/basemaps/germany-states/name"</span>)
<span class="no">r</span>$<span class="no">data</span>$<span class="no">values</span>
<span class="co">#&gt;  [1] "Nordrhein-Westfalen"    "Baden-Württemberg"      "Hessen"                </span>
<span class="co">#&gt;  [4] "Bremen"                 "Niedersachsen"          "Thüringen"             </span>
<span class="co">#&gt;  [7] "Hamburg"                "Schleswig-Holstein"     "Rheinland-Pfalz"       </span>
<span class="co">#&gt; [10] "Saarland"               "Bayern"                 "Berlin"                </span>
<span class="co">#&gt; [13] "Sachsen-Anhalt"         "Sachsen"                "Brandenburg"           </span>
<span class="co">#&gt; [16] "Mecklenburg-Vorpommern"</span></pre></body></html></div>
</div>
<div id="upload-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#upload-the-data" class="anchor"></a>Upload the data</h3>
<p>We are using a simple dataset for German States here as an example: It contains the share of foreign population per German federal state (<a href="https://www.statistikportal.de/de/bevoelkerung/auslaendische-bevoelkerung">source: Federal Statistical Office Germany (Destatis)</a>).</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">df_foreign_pop</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"data/foreign_pop.csv"</span>, <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_foreign_pop</span>)
<span class="co">#&gt; 'data.frame':    16 obs. of  2 variables:</span>
<span class="co">#&gt;  $ state                   : chr  "Baden-Württemberg" "Bayern" "Berlin" "Brandenburg" ...</span>
<span class="co">#&gt;  $ share_foreign_population: num  15.5 13.2 18.5 4.7 18.1 16.4 16.2 4.5 9.4 13.3 ...</span></pre></body></html></div>
<p>You can simply upload the data as you would do with any other {DatawRappr}-chart.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/dw_data_to_chart.html">dw_data_to_chart</a></span>(<span class="no">df_foreign_pop</span>, <span class="kw">chart_id</span> <span class="kw">=</span> <span class="no">new_choropleth_chart</span>)
<span class="co">#&gt; Chart data in LFukR successfully updated.</span></pre></body></html></div>
</div>
</div>
<div id="set-the-keys-in-the-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#set-the-keys-in-the-metadata" class="anchor"></a>Set the keys in the metadata</h2>
<p>The metadata of a chart gives us the full flexibility to change what we want to change. In this case, we have to set the axes. A chart in Datawrapper returned as a JSON-Object, which contains differents sublevels. One of those is called <em>metadata</em> and contains the relevant keys:</p>
<pre><code>"metadata": {
      "axes": {
          "keys": "KEY FROM DATA",
          "values": "VALUE FROM DATA"
      },
      "visualize": {
          "basemap": "ID of the basemap",
          "map-key-attr": "VALUE of the map key"
      }
}    </code></pre>
<p>In our example from above, we are using the names of the German federal states as the IDs. We will therefore use the basemap <strong>germany-states</strong> with the value <strong>name</strong>. <strong>name</strong> consists of the keys that are already present in our dataset in the <em>state</em>-column. So we don’t need any transformation here. We just need to tell Datawrapper which column to use.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/dw_edit_chart.html">dw_edit_chart</a></span>(<span class="no">new_choropleth_chart</span>,
              <span class="kw">axes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
                <span class="kw">keys</span> <span class="kw">=</span> <span class="st">"state"</span>,
                <span class="kw">values</span> <span class="kw">=</span> <span class="st">"share_foreign_population"</span>
                ),
              <span class="kw">visualize</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
                <span class="kw">basemap</span> <span class="kw">=</span> <span class="st">"germany-states"</span>,
                <span class="st">"map-key-attr"</span> <span class="kw">=</span> <span class="st">"name"</span>
                )
              )
<span class="co">#&gt; Chart LFukR succesfully updated.</span></pre></body></html></div>
<p>At that point, you might want to switch to Datawrapper’s UI to make the final adjustments to the legend before publishing. But: You could do them via <code>dw_edit_chart</code> as well. It’s probably just not that much fun.</p>
</div>
<div id="publish-the-chart" class="section level2">
<h2 class="hasAnchor">
<a href="#publish-the-chart" class="anchor"></a>Publish the chart</h2>
<p>This is probably the easiest part:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="../reference/dw_publish_chart.html">dw_publish_chart</a></span>(<span class="no">new_choropleth_chart</span>)
<span class="co">#&gt; Chart LFukR published!### Responsive iFrame-code: ###</span>
<span class="co">#&gt; &lt;iframe title="This is a automated choropleth map" aria-label="map" id="datawrapper-chart-LFukR" src="https://datawrapper.dwcdn.net/LFukR/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="undefined"&gt;&lt;/iframe&gt;&lt;script type="text/javascript"&gt;!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"])for(var e in a.data["datawrapper-height"]){var t=document.getElementById("datawrapper-chart-"+e)||document.querySelector("iframe[src*='"+e+"']");t&amp;&amp;(t.style.height=a.data["datawrapper-height"][e]+"px")}}))}();</span>
<span class="co">#&gt; &lt;/script&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ### Chart-URL:###</span>
<span class="co">#&gt; https://datawrapper.dwcdn.net/LFukR/1/</span></pre></body></html></div>
<div class="figure">
<img src="img/screenshot_choropleth_map.png" alt="Screenshot of the choropleth map"><p class="caption">Screenshot of the choropleth map</p>
</div>
<hr>
</div>
</div>
<div id="create-a-symbol-map" class="section level1">
<h1 class="hasAnchor">
<a href="#create-a-symbol-map" class="anchor"></a>Create a Symbol map</h1>
<p>A symbol map maps a certain value to a geographic location. We will use predefined coordinates here. Datawrapper’s user interface allows geocoding of adresses.</p>
<p>The workflow is pretty similar to the choropleth map. The main difference: We will use Latitude and Longitude coordinates, instead of the key.</p>
<div id="create-a-new-chart-1" class="section level2">
<h2 class="hasAnchor">
<a href="#create-a-new-chart-1" class="anchor"></a>Create a new chart</h2>
<p>You can use this code to create a new chart and save the chart to your current environment. You don’t have to save it. You will just need the chart-id later.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">new_symbol_chart</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/dw_create_chart.html">dw_create_chart</a></span>(
  <span class="kw">title</span> <span class="kw">=</span> <span class="st">"This is a automated symbol map"</span>,
  <span class="kw">type</span> <span class="kw">=</span> <span class="st">"d3-maps-symbols"</span>
  )
<span class="co">#&gt; New chart's id: dEtsA</span></pre></body></html></div>
</div>
<div id="upload-data-to-the-chart-1" class="section level2">
<h2 class="hasAnchor">
<a href="#upload-data-to-the-chart-1" class="anchor"></a>Upload data to the chart</h2>
<p>We will now upload some data to our newly created map. Beforehand, we have to decide on an basemap.</p>
<div id="select-the-right-map-1" class="section level3">
<h3 class="hasAnchor">
<a href="#select-the-right-map-1" class="anchor"></a>Select the right map</h3>
<p>Datawrapper provides an API-endpoint with their basemaps, which you might <code>curl</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1"><span class="ex">curl</span> --request GET \</a>
<a class="sourceLine" id="cb14-2" title="2">  --url https://api.datawrapper.de/plugin/basemaps</a></code></pre></div>
<p>Or you can use the built-in dataframe in {DatawRappr}:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">dw_basemaps</span>)
<span class="co">#&gt; # A tibble: 6 x 6</span>
<span class="co">#&gt;   id         level  slug   value      label      description                    </span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;                          </span>
<span class="co">#&gt; 1 world-2019 World  world  DW_NAME    Name       The three-letter ISO-code of t…</span>
<span class="co">#&gt; 2 world-2019 World  world  DW_STATE_… ISO-Code   The written name of the countr…</span>
<span class="co">#&gt; 3 world-2019 World  world  GERMAN_NA… Name (Ger… The written name of the countr…</span>
<span class="co">#&gt; 4 africa-20… Africa africa DW_NAME    Name       The three-letter ISO-code of t…</span>
<span class="co">#&gt; 5 africa-20… Africa africa DW_STATE_… ISO-Code   The written name of the countr…</span>
<span class="co">#&gt; 6 europe     Europe europe ISO_A3     ISO 3-dig… DE21, FR24, TR42, ...</span></pre></body></html></div>
<p>First, you have to decide, which map to use. It is identified by the <code>id</code>-column.</p>
<p>You can use dplyr’s <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> to get an interactive table. Or you might want to filter using <code><a href="https://rdrr.io/r/base/grep.html">grepl()</a></code></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">dw_basemaps</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"us-nyc"</span>, <span class="no">id</span>))
<span class="co">#&gt; # A tibble: 10 x 6</span>
<span class="co">#&gt;    id          level             slug            value  label     description   </span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;             &lt;chr&gt;           &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;         </span>
<span class="co">#&gt;  1 us-nyc-bor… USA » New York C… usa-new-york-c… BoroN… Borough … "Name of the …</span>
<span class="co">#&gt;  2 us-nyc-cen… USA » New York C… usa-new-york-c… BoroC… BoroCT20… ""            </span>
<span class="co">#&gt;  3 us-nyc-cen… USA » New York C… usa-new-york-c… geoid  GEOID co… ""            </span>
<span class="co">#&gt;  4 us-nyc-cit… USA » New York C… usa-new-york-c… CounD… Council … ""            </span>
<span class="co">#&gt;  5 us-nyc-com… USA » New York C… usa-new-york-c… BoroCD Boro CD … ""            </span>
<span class="co">#&gt;  6 us-nyc-hoo… USA » New York C… usa-new-york-c… NTANa… NTA Name  ""            </span>
<span class="co">#&gt;  7 us-nyc-hoo… USA » New York C… usa-new-york-c… NTACo… NTA Code  ""            </span>
<span class="co">#&gt;  8 us-nyc-pol… USA » New York C… usa-new-york-c… Preci… Precinct… ""            </span>
<span class="co">#&gt;  9 us-nyc-sch… USA » New York C… usa-new-york-c… Schoo… School D… ""            </span>
<span class="co">#&gt; 10 us-nyc-zip… USA » New York C… usa-new-york-c… ZIPCO… ZIP code  ""</span></pre></body></html></div>
</div>
<div id="upload-the-data-1" class="section level3">
<h3 class="hasAnchor">
<a href="#upload-the-data-1" class="anchor"></a>Upload the data</h3>
<p>We are using a simple dataset for German States here as an example: It contains the share of foreign population per German federal state (<a href="https://www.statistikportal.de/de/bevoelkerung/auslaendische-bevoelkerung">source: Federal Statistical Office Germany (Destatis)</a>).</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">df_foreign_pop_symbol</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"data/foreign_pop_symbol.csv"</span>, <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_foreign_pop_symbol</span>)
<span class="co">#&gt; 'data.frame':    16 obs. of  4 variables:</span>
<span class="co">#&gt;  $ Lat                     : num  48.6 48.9 52.5 52.8 53.1 ...</span>
<span class="co">#&gt;  $ Lon                     : num  9.19 11.4 13.39 13.25 8.81 ...</span>
<span class="co">#&gt;  $ name                    : chr  "Baden-Württemberg" "Bayern" "Berlin" "Brandenburg" ...</span>
<span class="co">#&gt;  $ share_foreign_population: num  15.5 13.2 18.5 4.7 18.1 16.4 16.2 4.5 9.4 13.3 ...</span></pre></body></html></div>
<p>The data is already geocoded into the <strong>Lat</strong> and <strong>Lon</strong>-columns. They are required for the symbol map.</p>
<hr>
<p><strong>Geocoding Adresses</strong></p>
<p>There are loads of resources on how to geocode places with R. For example, you might want to check out the <a href="https://github.com/dkahle/ggmap">{ggmap}</a>-package. Unfortunately geocoding with Google does require an API-Key.</p>
<p>For open alternatives you might have a look at <a href="https://github.com/hrbrmstr/nominatim">hrbrmstr’s {nominatim}</a> or the <code>geocode_OSM()</code>-function in <a href="https://github.com/mtennekes/tmaptools">{tmaptools}</a>.</p>
<hr>
<p>With Lat and Lon-columns set, you can simply upload the data as you would do with any other {DatawRappr}-chart.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/dw_data_to_chart.html">dw_data_to_chart</a></span>(<span class="no">df_foreign_pop_symbol</span>, <span class="kw">chart_id</span> <span class="kw">=</span> <span class="no">new_symbol_chart</span>)
<span class="co">#&gt; Chart data in dEtsA successfully updated.</span></pre></body></html></div>
</div>
</div>
<div id="set-the-keys-in-the-metadata-1" class="section level2">
<h2 class="hasAnchor">
<a href="#set-the-keys-in-the-metadata-1" class="anchor"></a>Set the keys in the metadata</h2>
<p>The metadata of a chart gives us the full flexibility to change what we want to change. In this case, we have to set the axes. A chart in Datawrapper returned as a JSON-Object, which contains differents sublevels. One of those is called <em>metadata</em> and contains the relevant keys:</p>
<pre><code>"metadata": {
        "axes": {
            "lat": "Lat-Col",
            "lon": "Lon-Col",
            "area": "Value-Col",
            "values": "Value-Col"
        },
      "visualize": {
          "basemap": "world-2019"
      }
}</code></pre>
<p>In our example from above, we are using the names of the German federal states as the IDs. We will therefore use the basemap <strong>germany-states</strong>. We just need to tell Datawrapper which basemap and columns to use for the mapping. Further options in <code>axes</code> would be:</p>
<ul>
<li>
<code>area</code>: for the area/size of the symbol</li>
<li>
<code>value</code>: for the color of the symbol</li>
</ul>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="../reference/dw_edit_chart.html">dw_edit_chart</a></span>(<span class="no">new_symbol_chart</span>,
              <span class="kw">axes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
                <span class="kw">lat</span> <span class="kw">=</span> <span class="st">"Lat"</span>,
                <span class="kw">lon</span> <span class="kw">=</span> <span class="st">"Lon"</span>,
                <span class="kw">area</span> <span class="kw">=</span> <span class="st">"share_foreign_population"</span>
                ),
              <span class="kw">visualize</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
                <span class="kw">basemap</span> <span class="kw">=</span> <span class="st">"germany-states"</span>
                )
              )
<span class="co">#&gt; Chart dEtsA succesfully updated.</span></pre></body></html></div>
<p>At that point, you might want to switch to Datawrapper’s UI to make the final adjustments to the legend before publishing. But: You could do them via <code>dw_edit_chart</code> as well. It’s probably just not that much fun.</p>
</div>
<div id="publish-the-chart-1" class="section level2">
<h2 class="hasAnchor">
<a href="#publish-the-chart-1" class="anchor"></a>Publish the chart</h2>
<p>This is probably the easiest part:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="../reference/dw_publish_chart.html">dw_publish_chart</a></span>(<span class="no">new_symbol_chart</span>)
<span class="co">#&gt; Chart dEtsA published!### Responsive iFrame-code: ###</span>
<span class="co">#&gt; &lt;iframe title="This is a automated symbol map" aria-label="map" id="datawrapper-chart-dEtsA" src="https://datawrapper.dwcdn.net/dEtsA/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="undefined"&gt;&lt;/iframe&gt;&lt;script type="text/javascript"&gt;!function(){"use strict";window.addEventListener("message",(function(a){if(void 0!==a.data["datawrapper-height"])for(var e in a.data["datawrapper-height"]){var t=document.getElementById("datawrapper-chart-"+e)||document.querySelector("iframe[src*='"+e+"']");t&amp;&amp;(t.style.height=a.data["datawrapper-height"][e]+"px")}}))}();</span>
<span class="co">#&gt; &lt;/script&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ### Chart-URL:###</span>
<span class="co">#&gt; https://datawrapper.dwcdn.net/dEtsA/1/</span></pre></body></html></div>
<div class="figure">
<img src="img/screenshot_symbol_map.png" alt="Screenshot of the symbol map"><p class="caption">Screenshot of the symbol map</p>
</div>
<hr>
</div>
</div>
<div id="including-tooltips" class="section level1">
<h1 class="hasAnchor">
<a href="#including-tooltips" class="anchor"></a>Including tooltips</h1>
<p>Including a tooltip is a task that is not only useful for maps, but also for scatterplots. The way to change them via tha API are pretty easy. Just use the <code>visualize</code>-argument in <code><a href="../reference/dw_edit_chart.html">dw_edit_chart()</a></code> and add a list which includes another list called <code>tooltip</code>.</p>
<p>tooltip has three different keys:</p>
<ul>
<li>
<code>body</code>: which is the body text of the tooltip. Add double brackets ton include a variable: <code>{{ variable }}</code>.</li>
<li>
<code>title</code>: is the title of the tooltip. It may also contain a variable with double brackets.</li>
<li>
<code>fields</code>: is a list that contains the mapping between the chart data and the variables in the tooltips. You have to include each variable here that is used in the tooltip double brackets in the format: <code>"variable in tooltip" = "variable in data"</code>. You may (although it makes things more complicated) map variables to different names, as shown below where <code>"name" = "b"</code>.</li>
</ul>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="../reference/dw_edit_chart.html">dw_edit_chart</a></span>(<span class="no">CHART_ID</span>, <span class="kw">visualize</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">tooltip</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    <span class="kw">body</span> <span class="kw">=</span> <span class="st">"{{ name }} has value {{ a }}."</span>,
    <span class="kw">title</span> <span class="kw">=</span> <span class="st">"{{ name }}"</span>,
    <span class="kw">fields</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
      <span class="st">"name"</span> <span class="kw">=</span> <span class="st">"b"</span>,
      <span class="st">"a"</span> <span class="kw">=</span> <span class="st">"a"</span>
    )
    )))</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.benedict-witzenberger.de">Benedict Witzenberger</a>, Bob Rudis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
